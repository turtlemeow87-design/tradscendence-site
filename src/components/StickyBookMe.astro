---
/* no frontmatter needed */
---
<!-- Floating "Book me" button -->
<div class="fixed right-4 bottom-4 md:bottom-auto md:top-4 z-50">
  <button
    id="open-book"
    class="rounded-2xl shadow-soft px-4 py-2 font-semibold bg-gold text-ivory hover:bg-golddark hover:text-rosewood focus:outline-none frame"
  >
    Book me
  </button>
</div>

<!-- Quick-book dialog -->
<dialog id="quick-book" class="rounded-2xl p-0 backdrop:bg-black/60">
  <form
    id="quick-book-form"
    class="relative p-5 space-y-4 bg-neutral-900 text-neutral-100 rounded-2xl"
  >
    <!-- Top-right X close -->
    <button
      type="button"
      id="close-book"
      aria-label="Close"
      class="absolute top-2 right-2 w-8 h-8 rounded-full bg-neutral-800 hover:bg-neutral-700 flex items-center justify-center"
    >
      &times;
    </button>

    <h2 class="text-xl font-semibold">Quick booking</h2>

    <!-- Notes above the mini form -->
    <div class="rounded-xl border border-gold/40 bg-gold/10 p-3 text-sm leading-relaxed frame">
      <p><strong>I require booking inquiries to be at minimum one month out from the date of your event!</strong></p>
      <p class="mt-1"><strong>I'm available for intimate events: proposals, private weddings, other ceremonies, small gatherings, funerals, and studio sessions.</strong></p>
    </div>

    <label class="block">
      <span class="text-sm">Your name *</span>
      <input name="name" required class="w-full mt-1 rounded-xl bg-black/40 p-2 border border-[var(--accent-bronze)]" />
    </label>

    <label class="block">
      <span class="text-sm">Email *</span>
      <input name="email" type="email" required class="w-full mt-1 rounded-xl bg-black/40 p-2 border border-[var(--accent-bronze)]" />
    </label>

    <label class="block">
      <span class="text-sm">Location (city/venue) *</span>
      <input name="location" required class="w-full mt-1 rounded-xl bg-black/40 p-2 border border-[var(--accent-bronze)]" placeholder="Richmond, VA" />
    </label>

    <label class="block">
      <span class="text-sm">Event date (If Applicable)</span>
      <input name="date" type="date" class="w-full mt-1 rounded-xl bg-black/40 p-2 border border-[var(--accent-bronze)]" />
    </label>

    <label class="block">
      <span class="text-sm">Message *</span>
      <textarea name="message" required rows="4" class="w-full mt-1 rounded-xl bg-black/40 p-2 border border-[var(--accent-bronze)]"></textarea>
    </label>

    <input type="hidden" name="formName" value="Quick booking" />

    <!-- Status message -->
    <div id="quick-status" class="hidden rounded-xl p-3 text-sm"></div>

    <div class="flex items-center justify-between gap-3">
      <a href="/contact" class="rounded-xl px-4 py-2 bg-neutral-700 text-neutral-100 frame">Full Contact Page</a>
      <button
        type="submit"
        id="quick-submit-btn"
        class="rounded-xl px-4 py-2 bg-gold text-ivory hover:bg-golddark hover:text-rosewood font-semibold frame"
      >
        Send
      </button>
    </div>
  </form>
</dialog>

<script>
  const openBtn = document.getElementById('open-book');
  const closeBtn = document.getElementById('close-book');
  const dialog = document.getElementById('quick-book') as HTMLDialogElement;
  const form = document.getElementById('quick-book-form') as HTMLFormElement;
  const submitBtn = document.getElementById('quick-submit-btn') as HTMLButtonElement;
  const statusDiv = document.getElementById('quick-status') as HTMLDivElement;

  openBtn?.addEventListener('click', () => dialog?.showModal());
  closeBtn?.addEventListener('click', () => dialog?.close());

  // Close on backdrop click
  dialog?.addEventListener('click', (e) => {
    const rect = dialog.getBoundingClientRect();
    const clickedInside = (
      e.clientX >= rect.left && e.clientX <= rect.right &&
      e.clientY >= rect.top && e.clientY <= rect.bottom
    );
    if (!clickedInside) dialog.close();
  });

  // Handle form submission
  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = new FormData(form);
    const data = Object.fromEntries(formData);

    // Update button state
    submitBtn.disabled = true;
    submitBtn.textContent = 'Sending...';
    statusDiv.classList.add('hidden');

    try {
      const response = await fetch('/api/contact.json', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });

      const result = await response.json();

      if (response.ok) {
        statusDiv.textContent = 'Message sent successfully!';
        statusDiv.className = 'rounded-xl p-3 text-sm bg-green-900/50 border border-green-500 text-green-100';
        statusDiv.classList.remove('hidden');
        form.reset();
        
        // Close dialog after short delay
        setTimeout(() => {
          dialog.close();
          statusDiv.classList.add('hidden');
        }, 2000);
      } else {
        throw new Error(result.error || 'Failed to send message');
      }
    } catch (error) {
      statusDiv.textContent = error instanceof Error ? error.message : 'Failed to send message. Please try again.';
      statusDiv.className = 'rounded-xl p-3 text-sm bg-red-900/50 border border-red-500 text-red-100';
      statusDiv.classList.remove('hidden');
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = 'Send';
    }
  });
</script>