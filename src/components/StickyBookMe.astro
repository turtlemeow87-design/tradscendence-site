---
// components/StickyBookMe.astro
---

<!-- Floating “Book me” button -->
<!-- StickyBookMe.astro (wrapper div) -->
<div class="fixed right-4 bottom-4 md:bottom-auto md:top-4 z-50">
  <!-- your button -->
<button id="open-book" class="rounded-2xl shadow-soft px-4 py-2 font-semibold bg-gold text-ivory hover:bg-golddark hover:text-rosewood focus:outline-none frame">
Book me
</button>
</div>


<!-- Quick-book dialog -->
<dialog id="quick-book" class="rounded-2xl p-0 backdrop:bg-black/60">
  <form action="https://formspree.io/f/mldwoalq" method="POST" class="p-5 space-y-4 bg-neutral-900 text-neutral-100 rounded-2xl">
    <h2 class="text-xl font-semibold">Quick booking</h2>

    <label class="block">
      <span class="text-sm">Your name</span>
      <input name="name" class="w-full mt-1 rounded-xl bg-black/40 p-2" />
    </label>

    <label class="block">
      <span class="text-sm">Email</span>
      <input name="email" type="email" required class="w-full mt-1 rounded-xl bg-black/40 p-2" />
    </label>

    <label class="block">
      <span class="text-sm">Event date</span>
      <input name="date" type="date" class="w-full mt-1 rounded-xl bg-black/40 p-2" />
    </label>

    <label class="block">
      <span class="text-sm">Message</span>
      <textarea name="message" rows="4" class="w-full mt-1 rounded-xl bg-black/40 p-2"></textarea>
    </label>

    <div class="flex items-center justify-between gap-3">
      <a id="mailto" href="#" class="rounded-xl px-4 py-2 bg-yellow-400 text-black">Email me</a>
      <button type="button" id="close-book" class="px-4 py-2 rounded-xl bg-neutral-700">Close</button>
    </div>
  </form>
</dialog>

<script is:raw>
  const openBtn = document.getElementById('open-book');
  const closeBtn = document.getElementById('close-book');
  const dialog  = document.getElementById('quick-book');
  const mailto  = document.getElementById('mailto');

  openBtn?.addEventListener('click', () => dialog?.showModal());
  closeBtn?.addEventListener('click', () => dialog?.close());

  // Build and launch a mailto from the quick form fields
  mailto?.addEventListener('click', (e) => {
    e.preventDefault();
    const form    = dialog?.querySelector('form');
    const name    = form?.querySelector('[name="name"]')?.value || '';
    const email   = form?.querySelector('[name="email"]')?.value || '';
    const date    = form?.querySelector('[name="date"]')?.value || '';
    const message = form?.querySelector('[name="message"]')?.value || '';

    const subject = encodeURIComponent(`Booking inquiry from ${name}`);
    const body    = encodeURIComponent(`Name: ${name}\nEmail: ${email}\nEvent date: ${date}\n\nMessage:\n${message}`);

    // ✅ Correct template string usage
    const href = `mailto:${email}?subject=${subject}&body=${body}`;

    window.location.href = href;
    dialog?.close();
  });
</script>
