---
import BaseLayout from "../../layouts/BaseLayout.astro";

const items = [
  { name: "Indian Surbahar",        file: "/media/surbahar.m4a",      href: "/instruments/Surbahar" },
  { name: "Indian Tanpura",         file: "/media/tanpura.m4a",       href: "/instruments/Tanpura"  },
  { name: "Pakistani Rabab",        file: "/media/rabab.m4a",         href: "/instruments/Rabab" },
  { name: "Indian Esraj",           file: "/media/esraj.m4a",         href: "/instruments/Esraj" },
  { name: "Turkish Kabak Kemane",   file: "/media/kemane.m4a",        href: "/coming-soon" },
  { name: "Turkish Baglama Saz",    file: "/media/baglamasaz1.m4a",   href: "/instruments/BaglamaSaz" },
  { name: "Turkish Divan Saz",      file: "/media/divansaz.m4a",      href: "/instruments/DivanSaz" },
  { name: "Turkish Cümbüş Tanbur",  file: "/media/tanbur.m4a",        href: "/instruments/Tanbur" },
  { name: "Turkish Cümbüş Oud",  file: "/media/CumbusOud.m4a",        href: "/instruments/CumbusOud" },
  { name: "Persian Setar",          file: "/media/setar.m4a",         href: "/coming-soon" },
  { name: "Armenian Duduk",         file: "/media/duduk.m4a",         href: "/instruments/Duduk" },
  { name: "Chinese Hulusi",         file: "/media/hulusi.m4a",        href: "/instruments/Hulusi" },
  { name: "Chinese Pipa",           file: "/media/pipa.m4a",          href: "/coming-soon" },
  { name: "Arabic Oud",             file: "/media/arabicoud.m4a",     href: "/instruments/ArabicOud" },
  { name: "Turkish Oud",            file: "/media/turkishoud.m4a",    href: "/instruments/TOud" },
  { name: "Azeri Tar",              file: "/media/tar.m4a",           href: "/instruments/AzeriTar" },
  { name: "Octave Mandolin",        file: "/media/octavemandolin.m4a",href: "/instruments/OM" },
];
---

<BaseLayout title="My Instruments — Tradscendence">
  <section class="instruments-page mx-auto max-w-6xl px-4 py-10 space-y-6">
    <h1 class="font-display text-3xl">My Instruments</h1>
    <p class="opacity-80">
      Instruments that I've collected and learned to play over the years. Hit the play
      button to <b>hear</b> a quick teaser that I made! Clicking the instrument's name sends
      you to the instrument's page. I hope you find a sound that you like! :)
    </p>

    <ul class="grid gap-4 sm:grid-cols-2 md:grid-cols-3">
      {items.map(({ name, file, href }) => (
        <li class="frame rounded-xl p-3 flex items-center justify-between">
          <a class="gothic-link" href={href}>{name}</a>
          <button
            type="button"
            class="opacity-60 hover:opacity-100 transition"
            data-audio={file}
            aria-label={`Play ${name} sample`}
          >
            ▶︎
          </button>
        </li>
      ))}
    </ul>
  </section>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const supportsHover = window.matchMedia('(hover: hover)').matches;

      const players = new Map();
      let current = null;

      function getPlayer(src) {
        if (!players.has(src)) {
          const a = new Audio(src);
          a.preload = 'none';
          players.set(src, a);
        }
        return players.get(src);
      }

      function stopCurrent() {
        if (current && !current.paused) {
          current.pause();
          current.currentTime = 0;
        }
      }

      async function play(src) {
        stopCurrent();
        const a = getPlayer(src);
        current = a;
        a.currentTime = 0;
        a.volume = 0.9;
        try {
          await a.play();
        } catch (err) {
          // Autoplay blocked or other issue — fail silently for hover
        }
      }

      document.querySelectorAll('[data-audio]').forEach((btn) => {
        const src = btn.getAttribute('data-audio');

        btn.addEventListener('click', () => play(src), { passive: true });

        if (supportsHover) {
          btn.addEventListener('mouseenter', () => play(src));
          btn.addEventListener('mouseleave', () => stopCurrent());
          btn.addEventListener('blur', () => stopCurrent());
        }
      });

      document.addEventListener('visibilitychange', () => {
        if (document.hidden) stopCurrent();
      });
    });
  </script>

  <style>
    .instruments-page ul li.frame {
      position: relative;
      background: linear-gradient(
        to right,
        rgba(205, 127, 50, 0.15),
        transparent
      );
      border-radius: 0.75rem;
      overflow: hidden;
    }

    .instruments-page ul li.frame::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      padding: 1px;
      background: linear-gradient(
        to right,
        rgba(205, 127, 50, 0.8),
        transparent
      );
      -webkit-mask:
        linear-gradient(#fff 0 0) content-box,
        linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
              mask-composite: exclude;
      pointer-events: none;
    }

    .instruments-page button[data-audio] {
      font-size: 1.75rem;
      color: var(--accent-gold, #C2A45F);
      text-shadow:
        2px 0 var(--bronze, #CD7F32),
       -2px 0 var(--bronze, #CD7F32),
        0 2px var(--bronze, #CD7F32),
        0 -2px var(--bronze, #CD7F32),
        2px 2px var(--bronze, #CD7F32),
       -3px -3px var(--bronze, #CD7F32),
        2px -2px var(--bronze, #CD7F32),
       -3px 3px var(--bronze, #CD7F32);
    }
  </style>
</BaseLayout>
