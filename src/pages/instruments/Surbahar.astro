---
// src/pages/instruments/Surbahar.astro
import BaseLayout from "../../layouts/BaseLayout.astro";
import Divider from "../../components/Divider.astro";

// ✅ SEO
const title = "Surbahar — Tradscendence | Sound Beyond Borders";
const description =
  "Two contrasting performances on surbahar (bass sitar)—upper and lower registers. Deep, resonant, meditative tone with expressive range. Short videos, story, and background.";

// Tip: for iframes, add `ratio: "16 / 9"` (or "4 / 3", etc.)
const videos = [
  {
    id: "v1",
    label: "Upper Register",
    type: "video",
    src: "/media/Surbahar1.mp4",
    poster: "",
  },
  {
    id: "v2",
    label: "Lower Register",
    type: "video",
    src: "/media/Surbahar2.mp4",
    poster: "",
  },
];
---

<BaseLayout {title} description={description}>

  <section class="mx-auto max-w-6xl px-4 py-10 space-y-8">
    <header class="space-y-2">
      <h1 class="font-display text-3xl md:text-4xl">Surbahar</h1>
      <p class="opacity-80 max-w-3xl">
        Deep, contemplative, and highly resonant..  
      </p>
    </header>

    <!-- Tabbed Hero Video -->
    <section class="rounded-2xl overflow-hidden frame border border-black/40 bg-black/20">
      <!-- Tabs -->
      <div
        class="tab-strip px-3 pt-3 sm:px-4 sm:pt-4"
        role="tablist"
        aria-label="Choose performance"
      >
        {videos.map((v, i) => (
          <button
            class="tab-button"
            data-tab={v.id}
            role="tab"
            aria-selected={i === 0 ? "true" : "false"}
            aria-controls={`pane-${v.id}`}
            id={`tab-${v.id}`}
          >
            {v.label}
          </button>
        ))}
      </div>

      <!-- Adaptive ratio shell (aspect-ratio driven by --ar) -->
      <div id="video-shell" class="relative w-full bg-black" style="aspect-ratio: var(--ar, 16 / 9);">
        {videos.map((v, i) => (
          <div
            id={`pane-${v.id}`}
            data-pane={v.id}
            role="tabpanel"
            aria-labelledby={`tab-${v.id}`}
            class={`video-pane ${i === 0 ? "is-active" : ""}`}
            data-ratio={v.ratio || ""}
          >
            {v.type === "video" && v.src ? (
              <video
                class="h-full w-full object-contain"
                controls
                playsinline
                preload="metadata"
                poster={v.poster || undefined}
              >
                <source src={v.src} />
              </video>
            ) : v.type === "iframe" && v.src ? (
              <iframe
                class="h-full w-full"
                src={v.src}
                title={v.label}
                loading="lazy"
                frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                allowfullscreen
              ></iframe>
            ) : (
              <div class="placeholder">
                <div class="placeholder-inner">
                  <span class="placeholder-title">Video coming soon</span>
                  <span class="placeholder-sub">Upload your source in this file’s <code>videos[]</code> config.</span>
                </div>
              </div>
            )}
          </div>
        ))}
      </div>
    </section>

    <!-- Story / description block -->
    <section class="prose-block">
      <h2 class="font-display text-2xl md:text-3xl">About this instrument</h2>
      <p class="opacity-80">
Many people mistake it for a sitar, but the Surbahar stands apart — larger in size, deeper in tone, and resonating with a rich, bass-like depth. I fell in love with its sustain and expressive range; it invites you to play slowly, to linger on every note, to let silence breathe between phrases. Instruments of this quality are rare, especially given how ornate their designs can be compared to the far more common sitar. The Surbahar feels at home in romantic, meditative, or even mournful settings, yet it’s remarkably versatile — capable of carrying the soul of Indian classical music as easily as a slow blues riff or even something with a metallic edge. You have to see and hear one in person to truly understand its power.  
<p>In the videos above, I’m playing within a blues pentatonic scale, adding a diminished second to give it that subtle, mysterious edge. The first video highlights the bright, sitar-like timbre of the highest string, while the second explores the instrument’s lower register — the deep, resonant voice the Surbahar is most celebrated for.</p>
      </p>

      <!-- Transition Divider -->
      <Divider />

      <!-- Recommended moods / genres -->
<section class="recommended-moods grid md:grid-cols-2 gap-6 items-center py-10">
  <!-- Audio mood list -->
  <div class="space-y-5 order-1 md:order-2">
    <h2 class="font-display text-2xl md:text-3xl mb-2">
  Recommended
  <span class="moods-title">
    <span class="m1">M</span>
    <span class="m2">o</span>
    <span class="m3">o</span>
    <span class="m4">d</span>
    <span class="m5">s</span>
  </span>
  for this instrument
</h2>

    <p class="opacity-80 text-base mb-4">
      The Surbahar’s range makes it ideal for a wide spectrum of feelings — from deep introspection to cinematic grandeur. Try exploring these moods below:
    </p>

    <ul class="space-y-3">
      {[
        { label: "Coming Soon!", file: "/media/surbahar-mood1.m4a" },
        { label: "Coming Soon!", file: "/media/surbahar-mood2.m4a" },
        { label: "Coming Soon!", file: "/media/surbahar-mood3.m4a" },
        { label: "Coming Soon!", file: "/media/surbahar-mood4.m4a" },
        { label: "Coming Soon!", file: "/media/surbahar-mood5.m4a" },
      ].map(({ label, file }) => (
        <li class="flex items-center justify-between rounded-xl px-3 py-2 frame">
          <span class="font-medium">{label}</span>
          <button
            type="button"
            class="opacity-70 hover:opacity-100 transition"
            data-audio={file}
            aria-label={`Play ${label}`}
          >
            ▶︎
          </button>
        </li>
      ))}
    </ul>
  </div>

  <!-- Placeholder image -->
  <figure class="rounded-xl overflow-hidden frame border border-black/40 shadow-soft order-2 md:order-1">
    <img
      src="/media/inst-surbahar.jpg"
      alt="Close-up of Surbahar"
      class="object-cover w-full h-full aspect-[4/3]"
      loading="lazy"
    />
  </figure>
</section>


    <!-- Keep Exploring link -->
    <div class="pt-8">
      <a
        href="/instruments"
        class="inline-flex items-center gap-2 font-display text-lg text-[var(--accent-gold)] hover:text-[var(--accent-rosewood)] transition-colors duration-200 group"
      >
        <span>Explore More Instruments</span>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.8"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="w-5 h-5 transform transition-transform duration-300 group-hover:translate-x-1"
        >
          <path d="M5 12h14"></path>
          <path d="M13 5l7 7-7 7"></path>
        </svg>
      </a>
    </div>
  </section>

  <style lang="css">
  /* ===== Tab strip ===== */
  .tab-strip {
    display: flex;
    flex-wrap: nowrap;
    gap: 0.375rem;
    overflow-x: auto;
    overflow-y: hidden;
    -webkit-overflow-scrolling: touch;
    scroll-snap-type: x proximity;
    scrollbar-width: none;
    mask-image: linear-gradient(to right, transparent 0, #000 12px, #000 calc(100% - 12px), transparent 100%);
  }
  .tab-strip::-webkit-scrollbar { display: none; }

  .tab-button {
    position: relative;
    flex: 0 0 auto;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.4ch;
    min-height: 2.2rem;
    padding: 0.55rem 0.9rem;
    border-radius: 0.75rem;
    font-weight: 600;
    line-height: 1;
    white-space: nowrap;
    min-width: max-content;
    background: transparent;
    color: var(--ivory);
    border: 1px solid transparent;
    transition: transform 160ms ease, background 160ms ease, border-color 160ms ease;
    outline: none;
    scroll-snap-align: start;
  }
  .tab-button::after {
    content: "";
    position: absolute;
    left: 0.9rem;
    right: 0.9rem;
    bottom: -2px;
    height: 2px;
    background: var(--accent-gold);
    transform: scaleX(0);
    transform-origin: left center;
    transition: transform 220ms ease;
    opacity: 0.9;
    filter: drop-shadow(0 0 6px rgba(194,164,95,0.65));
  }
  .tab-button:hover { transform: translateY(-1px); }
  .tab-button:hover::after { transform: scaleX(1); }
  .tab-button[aria-selected="true"] {
    border-color: rgba(255,255,255,0.1);
    background: rgba(255,255,255,0.04);
    box-shadow: inset 0 0 0 1px rgba(0,0,0,0.35);
  }
  .tab-button[aria-selected="true"]::after { transform: scaleX(1); }

  /* ===== Crossfade panes ===== */
  #video-shell { position: relative; }
  .video-pane {
    position: absolute;
    inset: 0;
    opacity: 0;
    pointer-events: none;
    transition: opacity 320ms ease;
    background: #000;
    display: flex;
  }
  .video-pane.is-active {
    opacity: 1;
    pointer-events: auto;
  }

  /* ===== Placeholder ===== */
  .placeholder {
    position: relative;
    width: 100%;
    height: 100%;
    background:
      radial-gradient(1200px 500px at 10% 10%, rgba(194,164,95,0.08), transparent 60%),
      radial-gradient(1000px 500px at 90% 30%, rgba(110,42,42,0.12), transparent 60%),
      rgba(0,0,0,0.5);
    display: grid;
    place-items: center;
  }
  .placeholder-inner {
    text-align: center;
    padding: 1rem 1.25rem;
    border-radius: 0.75rem;
    background: rgba(0,0,0,0.35);
    border: 1px solid rgba(255,255,255,0.08);
    box-shadow: inset 0 0 0 1px rgba(0,0,0,0.35);
  }
  .placeholder-title {
    display: block;
    font-weight: 700;
    font-size: 1.15rem;
    color: var(--ivory);
  }
  .placeholder-sub {
    display: block;
    margin-top: 0.25rem;
    opacity: 0.7;
  }

  .prose-block { display: grid; gap: 0.75rem; }

  /* ===== Recommended moods ===== */
  .recommended-moods img {
    object-position: center;
    filter: brightness(0.95) contrast(1.05);
  }

  .recommended-moods li.frame {
    background: linear-gradient(to right, rgba(205,127,50,0.15), transparent);
    border-radius: 0.75rem;
    position: relative;
    overflow: hidden;
  }

  .recommended-moods li.frame::before {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    padding: 1px;
    background: linear-gradient(to right, rgba(205,127,50,0.8), transparent);
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
            mask-composite: exclude;
    pointer-events: none;
  }

  .recommended-moods button[data-audio] {
    font-size: 1.5rem;
    color: var(--accent-gold, #C2A45F);
    text-shadow:
      2px 0 var(--bronze, #CD7F32),
     -2px 0 var(--bronze, #CD7F32),
      0 2px var(--bronze, #CD7F32),
      0 -2px var(--bronze, #CD7F32);
  }

  @media (max-width: 768px) {
    .recommended-moods { text-align: center; }
    .recommended-moods ul { max-width: 24rem; margin-inline: auto; }
  }
  /* ===== Refined "Moods" color sequence and styling ===== */
.moods-title {
  display: inline-flex;
  gap: 0.05ch;
  margin: 0 0.25ch;
  letter-spacing: 0.015em;
  line-height: 1;
  font-family: var(--font-display, "Cinzel"), serif;
  font-weight: 600;
}

.moods-title span {
  text-shadow: 0 0 6px rgba(0,0,0,0.25);
  mix-blend-mode: soft-light;
  transition: transform 220ms ease, filter 220ms ease, text-shadow 220ms ease;
}

.moods-title span:hover {
  transform: scale(1.07);
  filter: brightness(1.1);
  text-shadow: 0 0 10px rgba(255,255,255,0.25);
}

/* Rebalanced “Moods” palette — blue ➜ plum ➜ rosewood */
.m1 { color: #2C4C76; }  /* deep slate blue */
.m2 { color: #4F6C89; }  /* steel blue */
.m3 { color: #6B5A7A; }  /* muted purple / dusk violet */
.m4 { color: #7A4F4B; }  /* warm plum-brown */
.m5 { color: #6E2A2A; }  /* rosewood red */
.m3, .m4 { filter: saturate(0.85); }


/* Optional subtle shimmer (breathing gradient) */
@keyframes shimmer {
  0%   { filter: brightness(1); }
  50%  { filter: brightness(1.1) saturate(1.1); }
  100% { filter: brightness(1); }
}

.moods-title span {
  animation: shimmer 8s ease-in-out infinite;
  animation-delay: calc(var(--i, 0) * 1s);
}

/* Individual delays for more organic movement */
.m1 { --i: 0; }
.m2 { --i: 1; }
.m3 { --i: 2; }
.m4 { --i: 3; }
.m5 { --i: 4; }


  @media (max-width: 360px) {
    .tab-button { padding-inline: 0.7rem; }
    .tab-button::after { left: 0.7rem; right: 0.7rem; }
  }
  </style>

  <script type="module">
  // Tab behavior (existing)
  const tablist = document.querySelector('[role="tablist"]');
  const shell = document.getElementById('video-shell');
  const buttons = tablist ? Array.from(tablist.querySelectorAll('.tab-button')) : [];
  const panes = Array.from(document.querySelectorAll('.video-pane'));
  const ratioMap = new Map();

  const setShellRatio = (r) => shell?.style.setProperty('--ar', r || '16 / 9');

  const measurePane = (pane) => {
    const manual = pane.getAttribute('data-ratio');
    if (manual && manual.includes('/')) { ratioMap.set(pane.id, manual); return; }
    const vid = pane.querySelector('video');
    if (vid) {
      const apply = () => { const w = vid.videoWidth, h = vid.videoHeight; if (w && h) ratioMap.set(pane.id, `${w} / ${h}`); };
      vid.readyState >= 1 ? apply() : vid.addEventListener('loadedmetadata', apply, { once: true });
      return;
    }
    const ifr = pane.querySelector('iframe');
    if (ifr) ratioMap.set(pane.id, manual || '16 / 9');
  };
  panes.forEach(measurePane);

  const activate = (id) => {
    buttons.forEach(btn => {
      const sel = btn.dataset.tab === id;
      btn.setAttribute('aria-selected', sel ? 'true' : 'false');
      btn.tabIndex = sel ? 0 : -1;
    });
    panes.forEach(pane => {
      const active = pane.dataset.pane === id;
      pane.classList.toggle('is-active', active);
      if (!active) {
        pane.querySelector('video')?.pause();
        const ifr = pane.querySelector('iframe');
        if (ifr) { const src = ifr.src; ifr.src = src; }
      } else {
        const r = ratioMap.get(pane.id) || pane.getAttribute('data-ratio') || '16 / 9';
        setShellRatio(r);
      }
    });
  };

  if (tablist) {
    tablist.addEventListener('click', e => {
      const btn = e.target.closest('.tab-button');
      if (btn) activate(btn.dataset.tab);
    });
  }

  const initiallyActive = panes.find(p => p.classList.contains('is-active')) || panes[0];
  if (initiallyActive) {
    const applyInitial = () => setShellRatio(ratioMap.get(initiallyActive.id) || initiallyActive.getAttribute('data-ratio') || '16 / 9');
    const vid = initiallyActive.querySelector('video');
    vid && !(vid.readyState >= 1)
      ? vid.addEventListener('loadedmetadata', applyInitial, { once: true })
      : applyInitial();
  }

  const initiallySelected = buttons.find(b => b.getAttribute('aria-selected') === 'true') || buttons[0];
  buttons.forEach(b => (b.tabIndex = b === initiallySelected ? 0 : -1));

  // Audio play behavior (reused from instruments page)
  document.addEventListener('DOMContentLoaded', () => {
    const supportsHover = window.matchMedia('(hover: hover)').matches;
    const players = new Map();
    let current = null;

    const getPlayer = (src) => {
      if (!players.has(src)) players.set(src, new Audio(src));
      return players.get(src);
    };

    const stopCurrent = () => {
      if (current && !current.paused) {
        current.pause();
        current.currentTime = 0;
      }
    };

    const play = async (src) => {
      stopCurrent();
      const a = getPlayer(src);
      current = a;
      a.currentTime = 0;
      a.volume = 0.9;
      try { await a.play(); } catch {}
    };

    document.querySelectorAll('[data-audio]').forEach(btn => {
      const src = btn.getAttribute('data-audio');
      btn.addEventListener('click', () => play(src));
      if (supportsHover) {
        btn.addEventListener('mouseenter', () => play(src));
        btn.addEventListener('mouseleave', stopCurrent);
        btn.addEventListener('blur', stopCurrent);
      }
    });
    document.addEventListener('visibilitychange', () => { if (document.hidden) stopCurrent(); });
  });
  </script>
</BaseLayout>
